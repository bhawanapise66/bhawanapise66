var view,map,popup,container,content,closer,vectorSourceLine,vectorLayerLine,vectorSourceHistory,vectorLayerHistory,livetrailLine=[],livetrailicon="",routeArray=[],alertsArray=[],multiMarkers=[],singleMarker=[],poiMarkers=[],directionMarkers=[],alertsMarker=[],layers=[],poiFlag=0,routeFlag=0,polygonFlag=0,apiurl="",pageurl="",pageId="",headerkey="",pagename="";function mapBuild(e,r){try{vectorSourceHistory.clear(),vectorSourceLine.clear()}catch(e){}vectorSourceLine=new ol.source.Vector({}),vectorLayerLine=new ol.layer.Vector({source:vectorSourceLine}),vectorSourceHistory=new ol.source.Vector({}),vectorLayerHistory=new ol.layer.Vector({source:vectorSourceHistory});try{view=new ol.View({center:ol.proj.fromLonLat(r),maxZoom:19,minZoom:5,zoom:7}),layers.push(new ol.layer.Tile({visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"AqEn-Zmv686dbUmTZMsPBTMSVHaVudrwdc-_nUhYi6yTKwOI97eGxCqsRCxC6N0N",imagerySet:"Road"})})),layers.push(new ol.layer.Tile({visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"AqEn-Zmv686dbUmTZMsPBTMSVHaVudrwdc-_nUhYi6yTKwOI97eGxCqsRCxC6N0N",imagerySet:"AerialWithLabels"})})),layers.push(new ol.layer.Tile({visible:!1,preload:1/0,source:new ol.source.TileWMS({url:"https://api.tomtom.com/map/1/wms/?request=GetMap&srs=EPSG%3A3857&bbox=-0.489%2C51.28%2C0.236%2C51.686&width=512&height=512&format=image%2Fpng&layers=basic&version=1.1.1&key=EMAgQMM0q70KKQlY19lCG95Hz2DZKNOY",transition:0})})),layers.push(new ol.layer.Tile({visible:!1,preload:1/0,source:new ol.source.OSM})),layers.push(new ol.layer.Tile({visible:!1,preload:1/0,extent:[-20037508,-20037508,20037508,20037508],source:new ol.source.TileWMS({url:"http://164.52.201.137:2847/geoserver/generalLayers/wms",type:"base",params:{LAYERS:"generalLayers:India_State_region",TILED:!0,CRS:"EPSG:4326"},serverType:"geoserver"})})),layers.push(vectorLayerLine),layers.push(vectorLayerHistory),map=new ol.Map({target:e,loadTilesWhileAnimating:!0,layers:layers,view:view});try{var t=new ol.control.ZoomSlider;map.addControl(t)}catch(e){}}catch(e){}}function Livetrail(e,r,t,o){if(0==o){routeArray=[];var a=ol.proj.fromLonLat(e);try{FlyTo(a,function(){})}catch(e){}}var n=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))}),l=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,20],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})});n.setStyle(l),n.setProperties(r);var i=new ol.source.Vector({features:[n]}),s=new ol.layer.Vector({source:i});try{map.removeLayer(livetrailicon)}catch(e){}map.addLayer(s),livetrailicon=s;var c=ol.proj.fromLonLat(e);if(routeArray.push(c),2==routeArray.length){try{Drawroute(routeArray)}catch(e){}(routeArray=[]).push(c)}}function Drawroute(e){var r={LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"black",width:3})})},t={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[{type:"Feature",geometry:{type:"LineString",coordinates:e}}]},o=new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(t)}),a=new ol.layer.Vector({source:o,style:function(e){return r[e.getGeometry().getType()]}});map.addLayer(a),livetrailLine.push(a)}function PlotAlerts(e,r,t){var o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(r,"EPSG:4326","EPSG:3857"))}),a=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,8],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})});o.setStyle(a),o.setProperties(e);var n=new ol.source.Vector({features:[o]}),l=new ol.layer.Vector({source:n});map.addLayer(l),alertsArray.push(l)}function PopupInitialize(){popup=new ol.Overlay({element:container,autoPan:!0,autoPanAnimation:{duration:250}}),map.addOverlay(popup),closer.onclick=function(){return popup.setPosition(void 0),closer.blur(),!1};try{map.on("pointermove",function(e){try{map.forEachFeatureAtPixel(e.pixel,function(e,r){var t=e.getGeometry().getCoordinates(),o=e.getProperties(),a="";if("live"==(o="features"in o?o.features[0].values_.data:e.getProperties().data).type||"cluster"==o.type){try{var n="<div class='popupMainDiv'><table class='table-striped popCustomTable'><tr></tr>"}catch(e){}for(var l in o)if(o.hasOwnProperty(l)){if("title"==l)n=n+"<tr class='tableheader'><td colspan='2' style='text-align:center'>"+o[l]+"</td></tr>";else if("type"!=l)if("direction"==l);else if("maptrack"==l);else if("VehicleStatus"==l);else{n=n+"<tr><td class='leftTd'>"+l+"</td><td class='rightTd'><span style='color:"+("GPS Status"==l||"Gps Status"==l?"Valid"==o[l]||"VALID"==o[l]?"green":"red":"Status"==l?"Not Connected"==o[l]?"yellow":"Never Connected"==o[l]?"red":"Connected"==o[l]?"green":"red":"")+"'>"+o[l]+"</span></td></tr>"}if("maptrack"==l)a="<div style='    display: flex; padding-top: 9px;  padding-bottom: 8px;'><div style='color: white;cursor:pointer;background-color: #030344; width: 81px; text-align: center;font-weight: bold;font-size: 12px;  margin-left: 43px;' onclick="+('livetrackfunction("'+o.maptrack+'")')+">Live Track</div><div style='color: white;cursor:pointer;background-color: #030344; width: 90px; text-align: center;font-weight: bold;font-size: 12px;  margin-left: 20px;' onclick="+('historytrackfunction("'+o.maptrack+'")')+">History Track</div></div>"}n=n+"</table></div>"+a,content.innerHTML=n,popup.setPosition(t)}})}catch(e){}})}catch(e){}}function SingleMarker(e,r,t,o){var a=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))});a.setStyle(function(e,r){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,20],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:o}),text:createTextStyle(e,r)})}),a.setProperties(r);var n=new ol.source.Vector({features:[a]}),l=new ol.layer.Vector({source:n});try{map.addLayer(l)}catch(e){}singleMarker.push(l);var i=a.getProperties().data;try{var s="<div class='popupMainDiv'><table class='popCustomTable'><tr></tr>"}catch(e){}var c="";for(var p in i)if(i.hasOwnProperty(p)){if("title"==p)s=s+"<tr class='tableheader'><td colspan='2' style='text-align:center'>"+i[p]+"</td></tr>";else if("type"!=p)if("direction"==p);else if("maptrack"==p);else if("VehicleStatus"==p);else{s=s+"<tr><td class='leftTd'>"+p+"</td><td class='rightTd'><span style='color:"+("GPS Status"==p||"Gps Status"==p?"Valid"==i[p]||"VALID"==i[p]?"green":"red":"Status"==p?"Not Connected"==i[p]?"yellow":"Never Connected"==i[p]?"red":"Connected"==i[p]?"green":"red":"")+"'>"+i[p]+"</span></td></tr>"}if("maptrack"==p)c="<div style='    display: flex; padding-top: 9px;  padding-bottom: 8px;'><div style='color: white;cursor:pointer;background-color: #030344; width: 81px; text-align: center;font-weight: bold;font-size: 12px;  margin-left: 43px;' onclick="+('livetrackfunction("'+i.maptrack+'")')+">Live Track</div><div style='color: white;cursor:pointer;background-color: #030344; width: 90px; text-align: center;font-weight: bold;font-size: 12px;  margin-left: 20px;' onclick="+('historytrackfunction("'+i.maptrack+'")')+">History Track</div></div>"}s=s+"</table></div>"+c;var u=a.getGeometry().getCoordinates();content.innerHTML=s,popup.setPosition(u)}function getText(e,r){var t=e.getProperties().data,o="";for(var a in t)"Updated At"==a&&(o=o+"\n"+t[a]),"title"==a&&(o=t[a]);return o}function createTextStyle(e,r){var t="6px";if(1/Math.pow(r,1/3)*10+1<4)t="0px";else t="10px";var o="normal "+t+"/1 "+(o="Arial");return new ol.style.Text({textAlign:"center",textBaseline:"middle",font:o,backgroundFill:new ol.style.Fill({color:"white"}),text:getText(e,r),fill:new ol.style.Fill({color:"black"}),stroke:new ol.style.Stroke({color:"black",width:0}),offsetX:50,offsetY:20,placement:"point",maxAngle:.7853981633974483,overflow:"false",rotation:0})}function PoiplotFunction(e,r,t){var o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))}),a=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,30],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})});o.setStyle(a),o.setProperties(r);var n=new ol.source.Vector({features:[o]}),l=new ol.layer.Vector({source:n});map.addLayer(l),poiMarkers.push(l)}function ClearPoi(){for(var e=0;e<poiMarkers.length;e++)try{map.removeLayer(poiMarkers[e])}catch(e){}}function ClearSingleMarkers(){for(var e=0;e<singleMarker.length;e++)try{map.removeLayer(singleMarker[e])}catch(e){}}function ClearLiveTrail(){for(var e=0;e<livetrailLine.length;e++)try{map.removeLayer(livetrailLine[e])}catch(e){}livetrailLine=[];try{map.removeLayer(livetrailicon)}catch(e){}routeArray=[]}function DirectionIcon(e,r,t){var o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))}),a=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,20],scale:.5,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})});o.setStyle(a),o.setProperties(r);var n=new ol.source.Vector({features:[o]}),l=new ol.layer.Vector({source:n});map.addLayer(l),directionMarkers.push(l)}function AlertDetails(e,r,t){var o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(e,"EPSG:4326","EPSG:3857"))}),a=new ol.style.Style({image:new ol.style.Icon({scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})});o.setStyle(a),o.setProperties(r);var n=new ol.source.Vector({features:[o]}),l=new ol.layer.Vector({source:n});map.addLayer(l),alertsMarker.push(l)}function ClearAlert(){for(var e=0;e<alertsMarker.length;e++)try{map.removeLayer(alertsMarker[e])}catch(e){}}function FlyTo(e,r){view.getZoom();var t=2,o=!1;function a(e){--t,o||0!==t&&e||(o=!0,r(e))}view.animate({center:e,duration:2e3},a),view.animate({zoom:20,duration:1e3},a)}function Getdetails(e){}function ClearDirection(){for(var e=0;e<directionMarkers.length;e++)map.removeLayer(directionMarkers[e]);directionMarkers=[]}function ClearRoute(){for(var e=0;e<railwayRoutes.length;e++)map.removeLayer(railwayRoutes[e]);railwayRoutes=[]}function ClearRailPoi(){for(var e=0;e<railpoiLayer.length;e++)map.removeLayer(railpoiLayer[e]);railpoiLayer=[]}function openFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function CustomFlyTo(e){var r=ol.proj.fromLonLat(e);try{FlyTo(r,function(){})}catch(e){}}function CustomFlyTo2(e){var r=ol.proj.fromLonLat(e);try{FlyTo(r,function(){})}catch(e){}}function Removeinsertpopup(){popup.setPosition(void 0)}function GetDistance(e,r,t,o,a){if(e==t&&r==o)return 0;var n=Math.PI*e/180,l=Math.PI*t/180,i=r-o,s=Math.PI*i/180,c=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos(s);return c>1&&(c=1),c=60*(c=180*(c=Math.acos(c))/Math.PI)*1.1515,"K"==a&&(c*=1.609344),"N"==a&&(c*=.8684),c}function GetEmergencyDetails(e,r){alert("xdata    "+e+"   ydata    "+r)}