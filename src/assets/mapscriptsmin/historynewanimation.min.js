var historyinterval,historydata,i=0,historypointmarkers=[],historyanimationline=[],totaldistancehistory=0,animationspeed=1100;function AnimationLine(t,e){vectorSourceHistory.clear(),vectorSourceLine.clear(),totaldistancehistory=0,animationspeed=1100-100*e,historydata=t;try{clearInterval(historyinterval)}catch(t){}historyinterval=setInterval(function(){var e=[];if(i<t.length){if(i>=1){var r=[];r.push(Number(t[i-1].param4)),r.push(Number(t[i-1].param3)),e.push(r),(r=[]).push(Number(t[i].param4)),r.push(Number(t[i].param3)),e.push(r);var a="blue";a=Number(t[i].param5)>5?"red":"blue",Drawline(e,t[i-1],a)}i==t.length&&ClearHistoryInterval(),i++}},animationspeed),lineString}function Drawline(t,e,r){var a=GetDistance(t[0][1],t[0][0],t[1][1],t[1][0],"K");totaldistancehistory+=a;var i=new ol.geom.LineString(t);i.transform("EPSG:4326","EPSG:3857");var o=i.getCoordinates(),n=(new ol.style.Style({stroke:new ol.style.Stroke({color:r,width:3})}),new ol.style.Style({fill:new ol.style.Fill({color:"#00FF00",weight:4}),stroke:new ol.style.Stroke({color:r,width:3})})),s=new ol.Feature({geometry:i});s.setStyle(n),vectorSourceLine.addFeature(s);var l=GetDirectionIcon((e={data:{type:"live",title:e.param19,"Date/ Time":e.param2,Speed:e.param5,direction:e.param7,Distance:totaldistancehistory.toFixed(2)+" km"}}).data);HistoryPoint(o[0],e,l)}function HistoryPoint(t,e,r){var a=new ol.Feature({geometry:new ol.geom.Point(t)});a.setStyle(function(t,e){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,20],scale:.5,anchorXUnits:"fraction",anchorYUnits:"pixels",src:r})})}),a.setProperties(e),vectorSourceHistory.addFeatures([a]);var i=a.getProperties().data;try{var o="<div class='popupMainDiv'><table class='popCustomTable'><tr></tr>"}catch(t){}for(var n in i)if(i.hasOwnProperty(n))if("title"==n)o=o+"<tr class='tableheader'><td colspan='2' style='text-align:center'>"+i[n]+"</td></tr>";else if("direction"==n);else if("type"!=n){o=o+"<tr><td class='leftTd'>"+n+"</td><td class='rightTd'><span style='color:"+("GPS Status"==n||"Gps Status"==n?"Valid"==i[n]||"VALID"==i[n]?"green":"red":"Status"==n?"Not Connected"==i[n]?"yellow":"Never Connected"==i[n]?"red":"Connected"==i[n]?"green":"red":"")+"'>"+i[n]+"</span></td></tr>"}o+="</table></div>";var s=a.getGeometry().getCoordinates();content.innerHTML=o,popup.setPosition(s)}function ClearHistoryInterval(){try{clearInterval(historyinterval)}catch(t){}}function ResumeAnimation(t){animationspeed=1100-100*t;try{clearInterval(historyinterval)}catch(t){}historyinterval=setInterval(function(){var t=[];if(i>=1){var e=[];e.push(Number(historydata[i-1].param4)),e.push(Number(historydata[i-1].param3)),t.push(e),(e=[]).push(Number(historydata[i].param4)),e.push(Number(historydata[i].param3)),t.push(e);var r="blue";r=Number(historydata[i].param5)>Number(historydata[i].param25)?"red":"blue",Drawline(t,historydata[i],r);var a={data:{type:"live",title:historydata[i].param19,"Date/ Time":historydata[i].param2,Speed:historydata[i].param5,direction:historydata[i].param7,Distance:totaldistancehistory.toFixed(2)+" km"}},o=GetDirectionIcon(a.data);try{HistoryPoint(historylinecoords[0],a,o)}catch(t){}}i==historydata.length&&ClearHistoryInterval(),i++},animationspeed)}function RestartAnimation(t){totaldistancehistory=0,animationspeed=1100-100*t;try{clearInterval(historyinterval)}catch(t){}i=0,historyinterval=setInterval(function(){var t=[];if(i>=1){var e=[];e.push(Number(historydata[i-1].param4)),e.push(Number(historydata[i-1].param3)),t.push(e),(e=[]).push(Number(historydata[i].param4)),e.push(Number(historydata[i].param3)),t.push(e),Drawline(t,historydata[i])}i==historydata.length&&ClearHistoryInterval(),i++},500)}function GetDirectionIcon(t){return"assets/mapimages/directionarrow/arrow-"+GetDirection(t.direction)}function ClearHistoryAnimation1(){ClearHistoryInterval(),totaldistancehistory=0,t=0;for(var t=0;t<historypointmarkers.length;t++)map.removeLayer(historypointmarkers[t]);historypointmarkers=[];for(t=0;t<historyanimationline.length;t++)map.removeLayer(historyanimationline[t]);historyanimationline=[],vectorSourceHistory.clear(),vectorSourceLine.clear()}function CompleteHistoryDrawline(t,e,r){var a=GetDistance(t[0][1],t[0][0],t[1][1],t[1][0],"K");totaldistancehistory+=a;var i=new ol.geom.LineString(t);i.transform("EPSG:4326","EPSG:3857");var o=i.getCoordinates(),n=(new ol.style.Style({stroke:new ol.style.Stroke({color:r,width:3})}),new ol.style.Style({fill:new ol.style.Fill({color:"#00FF00",weight:4}),stroke:new ol.style.Stroke({color:r,width:3})})),s=new ol.Feature({geometry:i});s.setStyle(n),vectorSourceLine.addFeature(s);var l=GetDirectionIcon((e={data:{type:"live",title:e.param19,"Date/ Time":e.param2,Speed:e.param5,direction:e.param7,Distance:totaldistancehistory.toFixed(2)+" km"}}).data);try{CompleteHistoryPoint(o[0],e,l)}catch(t){}}function PlotCompleteHistory(){try{clearInterval(historyinterval)}catch(t){}e=0;for(var t=[],e=0;e<historydata.length;e++)if(e>1){2==t.length&&(t=[]);var r=[];r.push(Number(historydata[e-1].param4)),r.push(Number(historydata[e-1].param3)),t.push(r),(r=[]).push(Number(historydata[e].param4)),r.push(Number(historydata[e].param3)),t.push(r);var a="blue";a=Number(historydata[e].param5)>5?"red":"blue";try{CompleteHistoryDrawline(t,historydata[e],a)}catch(t){}}}function CompleteHistoryPoint(t,e,r){var a=new ol.Feature({geometry:new ol.geom.Point(t)});a.setStyle(function(t,e){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,20],scale:.5,anchorXUnits:"fraction",anchorYUnits:"pixels",src:r})})}),a.setProperties(e),vectorSourceHistory.addFeatures([a])}