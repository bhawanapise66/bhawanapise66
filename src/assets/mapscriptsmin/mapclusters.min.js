var sectionClusters,vector=null,northClusters=[],southClusters=[],westClusters=[],eastClusters=[],centralClusters=[],subdivisionClusterLayer="";function MakeClusters(e){try{var t=[];t.push(Number(e[0].param36)),t.push(Number(e[0].param35))}catch(e){}new ol.style.Fill({color:"red"}),new ol.style.Stroke({color:"#0000",width:1});var r,a=new ol.style.Fill({color:"#00000"});new ol.style.Stroke({color:"rgba(0, 0, 0, 0.6)",width:3}),new ol.style.Fill({color:"rgba(255, 255, 255, 0.01)"});function o(e){e.get("name");var t=GetIcon(e.getProperties().data);return new ol.style.Style({geometry:e.getGeometry(),image:new ol.style.Icon({anchor:[.5,20],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:t})})}var n,s=function(e){r=0;for(var t,a,o=vector.getSource().getFeatures(),n=o.length-1;n>=0;--n){var s,l=(t=o[n]).get("features"),i=ol.extent.createEmpty(),c=void 0;for(c=0,s=l.length;c<s;++c)ol.extent.extend(i,l[c].getGeometry().getExtent());r=Math.max(r,s),a=.2*(ol.extent.getWidth(i)+ol.extent.getHeight(i))/e,t.set("radius",a)}};for(var l=new Array(e.length),i=0;i<e.length;i++){try{var c={data:{type:"cluster",title:e[i].param12,"Updated At":e[i].param32,VehicleStatus:e[i].param47,Speed:e[i].param37+" km/hr",Ignition:e[i].param42,"GPS Status":e[i].param39,Direction:e[i].param46,direction:e[i].param40,"Vehicle Type":e[i].param29,maptrack:e[i].param11}}}catch(e){}var u=[];u.push(Number(e[i].param36)),u.push(Number(e[i].param35));var p=ol.proj.fromLonLat(u);l[i]=new ol.Feature(new ol.geom.Point(p)),l[i].setProperties(c)}var m=new ol.source.Vector({features:l});vector=new ol.layer.Vector({source:new ol.source.Cluster({distance:40,source:m}),style:function(e,t){var r;t!=n&&(s(t),n=t);var l=e.get("features").length;if(l>1){var i="";i=l>200?[134,232,255]:l>120?[164,255,255]:l>50?[237,240,139]:[180,242,133],r=new ol.style.Style({image:new ol.style.Circle({radius:e.get("radius"),fill:new ol.style.Fill({color:i})}),text:new ol.style.Text({text:l.toString(),font:"bold 14px serif",fill:a})})}else r=o(e.get("features")[0]);return r}}),map.addLayer(vector)}function MakePersonClusters(e){try{var t=[];t.push(Number(e[0].param36)),t.push(Number(e[0].param35));try{FlyToCluster(t,function(){})}catch(e){}}catch(e){}new ol.style.Fill({color:"red"}),new ol.style.Stroke({color:"#0000",width:1});var r,a=new ol.style.Fill({color:"black"});new ol.style.Fill({color:"rgba(255, 255, 255, 0.01)"});function o(e,t){e.get("name");var r="",a=e.getProperties().data.Status;r="Non Polling"==a?"assets/mapimages/personicons/personiconred.png":"Idle"==a?"assets/mapimages/personicons/personiconyellow.png":"Working"==a?"assets/mapimages/personicons/personicongreen.png":"Stop"==a?"assets/mapimages/personicons/personiconred.png":"assets/mapimages/personicons/personiconblack.png";return new ol.style.Style({geometry:e.getGeometry(),image:new ol.style.Icon({anchor:[.5,20],scale:.8,anchorXUnits:"fraction",anchorYUnits:"pixels",src:r}),text:createTextStyle(e,t)})}var n,s=function(e){r=0;for(var t,a,o=vector.getSource().getFeatures(),n=o.length-1;n>=0;--n){var s,l=(t=o[n]).get("features"),i=ol.extent.createEmpty(),c=void 0;for(c=0,s=l.length;c<s;++c)ol.extent.extend(i,l[c].getGeometry().getExtent());r=Math.max(r,s),(a=.25*(ol.extent.getWidth(i)+ol.extent.getHeight(i))/e)<10?t.set("radius",20):t.set("radius",a)}};for(var l=[],i=new Array(e.length),c=0;c<e.length;c++){try{var u={data:{type:"cluster",title:e[c].param12,"Updated At":e[c].param32,VehicleStatus:e[c].param47,Speed:e[c]+" km/hr",Ignition:e[c].param42,Status:e[c].param47,"GPS Status":e[c].param39,Direction:e[c].param46,"Vehicle Type":e[c].param29}}}catch(e){}var p=[];p.push(Number(e[c].param36)),p.push(Number(e[c].param35));var m=ol.proj.fromLonLat(p);l.push(m),i[c]=new ol.Feature(new ol.geom.Point(m)),i[c].setProperties(u)}var g=new ol.source.Vector({features:i});vector=new ol.layer.Vector({source:new ol.source.Cluster({distance:40,source:g}),style:function(e,t){var r;t!=n&&(s(t),n=t);var l,i=e.get("features").length;i>1?(l=[237,240,139],r=new ol.style.Style({image:new ol.style.Circle({radius:e.get("radius"),fill:new ol.style.Fill({color:l})}),text:new ol.style.Text({text:i.toString(),font:"bold 14px serif",fill:a})})):r=o(e.get("features")[0],t);return r}}),map.addLayer(vector)}function ClearCluster(){try{map.removeLayer(vector)}catch(e){}}function FlyToCluster(e,t){var r=ol.proj.fromLonLat(e),a=(view.getZoom(),2),o=!1;function n(e){--a,o||0!==a&&e||(o=!0,t(e))}view.animate({center:r,duration:2e3},n),view.animate({zoom:8,duration:1e3},{zoom:8,duration:1e3},n)}function GetIcon(e){var t="",r=GetDirection(Number(e.direction)),a=GetVehicleColor(e.VehicleStatus);for(var o in e)"Vehicle Type"==o&&(t="Maxi Cab"==e[o]?"assets/mapimages/vehiclesicon/taxi/icon-"+r:"School Bus"==e[o]?"assets/mapimages/vehiclesicon/bus/"+a+"/icon-"+r:"Tanker"==e[o]?"assets/mapimages/vehiclesicon/tanker/"+a+"/icon-"+r:"Taxi"==e[o]?"assets/mapimages/vehiclesicon/taxi/"+a+"/icon-"+r:"Truck"==e[o]?"assets/mapimages/vehiclesicon/truck/"+a+"/icon-"+r:"KM"==e[o]||"PT"==e[o]||"Trailer"==e[o]?"assets/mapimages/personicons/personiconblack.png":"Dumper/Tipper"==e[o]?"assets/mapimages/vehiclesicon/truck/"+a+"/icon-"+r:(e[o],"assets/mapimages/vehiclesicon/jeep/"+a+"/icon-"+r));return t}function GetDirectionIcon(e){return"assets/mapimages/directionarrow/arrow-"+GetDirection(Number(e.direction))}function GetDirection(e){return dirstring="",dirstring=e>=345&&e<35?"0.png":e>=35&&e<75?"45.png":e>=75&&e<135?"90.png":e>=135&&e<165?"135.png":e>=165&&e<195?"180.png":e>=195&&e<255?"225.png":e>=255&&e<285?"270.png":e>=285&&e<345?"315.png":"0.png",dirstring}function GetVehicleColor(e){return"Running"==e?"green":"Idle"==e?"yellow":(e="Stop")?"red":"blue"}